{% extends 'projects/base.html' %}

{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - DX Consulting CRM{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem;">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

<!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
<div class="grid grid-4" style="margin-bottom: 2rem;">
    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <h3>{{ new_projects_count }}</h3>
        <p>ä»Šæœˆã®æ–°è¦æ¡ˆä»¶</p>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <h3>{{ active_projects_count }}</h3>
        <p>é€²è¡Œä¸­ã®æ¡ˆä»¶</p>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <h3>Â¥{{ total_estimated|floatformat:0|default:"0" }}</h3>
        <p>è¦‹ç©ç·é¡</p>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
        <h3>{{ pending_handoffs|length }}</h3>
        <p>å¼•ç¶™ãå¾…ã¡</p>
    </div>
</div>

<!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥æ¡ˆä»¶æ•° -->
<div class="card">
    <h2>ğŸ“ˆ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥æ¡ˆä»¶æ•°</h2>
    <table>
        <thead>
            <tr>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>ä»¶æ•°</th>
            </tr>
        </thead>
        <tbody>
            {% for stat in status_stats %}
            <tr>
                <td>
                    {% if stat.status == 'inquiry' %}åˆå›ç›¸è«‡
                    {% elif stat.status == 'hearing' %}ãƒ’ã‚¢ãƒªãƒ³ã‚°ä¸­
                    {% elif stat.status == 'proposal' %}ææ¡ˆä½œæˆä¸­
                    {% elif stat.status == 'quotation' %}è¦‹ç©æç¤º
                    {% elif stat.status == 'negotiation' %}å•†è«‡ä¸­
                    {% elif stat.status == 'handover' %}ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å¼•ç¶™ã
                    {% elif stat.status == 'in_progress' %}å®Ÿæ–½ä¸­
                    {% elif stat.status == 'completed' %}å®Œäº†
                    {% elif stat.status == 'on_hold' %}ä¿ç•™
                    {% elif stat.status == 'lost' %}å¤±æ³¨
                    {% endif %}
                </td>
                <td><strong>{{ stat.count }}</strong>ä»¶</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- æœ€è¿‘ã®æ¡ˆä»¶ -->
<div class="card">
    <h2>ğŸ†• æœ€è¿‘ã®æ¡ˆä»¶</h2>
    <table>
        <thead>
            <tr>
                <th>æ¡ˆä»¶å</th>
                <th>é¡§å®¢</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>è¦‹ç©é‡‘é¡</th>
                <th>ä½œæˆæ—¥</th>
            </tr>
        </thead>
        <tbody>
            {% for project in recent_projects %}
            <tr>
                <td><a href="{% url 'projects:project_detail' project.pk %}">{{ project.title }}</a></td>
                <td>{{ project.client.company_name }}</td>
                <td>
                    {% if project.status == 'inquiry' %}<span class="badge badge-info">åˆå›ç›¸è«‡</span>
                    {% elif project.status == 'hearing' %}<span class="badge badge-primary">ãƒ’ã‚¢ãƒªãƒ³ã‚°ä¸­</span>
                    {% elif project.status == 'proposal' %}<span class="badge badge-warning">ææ¡ˆä½œæˆä¸­</span>
                    {% elif project.status == 'negotiation' %}<span class="badge badge-warning">å•†è«‡ä¸­</span>
                    {% elif project.status == 'in_progress' %}<span class="badge badge-success">å®Ÿæ–½ä¸­</span>
                    {% elif project.status == 'completed' %}<span class="badge badge-success">å®Œäº†</span>
                    {% else %}<span class="badge">{{ project.get_status_display }}</span>
                    {% endif %}
                </td>
                <td>{% if project.estimated_amount %}Â¥{{ project.estimated_amount|floatformat:0 }}{% else %}æœªè¨­å®š{% endif %}</td>
                <td>{{ project.created_at|date:"Y/m/d" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å¼•ç¶™ãå¾…ã¡ -->
{% if pending_handoffs %}
<div class="card">
    <h2>âš ï¸ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å¼•ç¶™ãå¾…ã¡</h2>
    <table>
        <thead>
            <tr>
                <th>æ¡ˆä»¶å</th>
                <th>ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢</th>
                <th>å¼•ç¶™ãæ—¥</th>
                <th>äºˆç®—</th>
            </tr>
        </thead>
        <tbody>
            {% for handoff in pending_handoffs %}
            <tr>
                <td><a href="{% url 'projects:project_detail' handoff.project.pk %}">{{ handoff.project.title }}</a></td>
                <td>{{ handoff.engineer_name }}</td>
                <td>{{ handoff.handoff_date|date:"Y/m/d H:i" }}</td>
                <td>{% if handoff.budget %}Â¥{{ handoff.budget|floatformat:0 }}{% else %}æœªè¨­å®š{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- æœ€è¿‘ã®æ´»å‹•è¨˜éŒ² -->
<div class="card">
    <h2>ğŸ“ æœ€è¿‘ã®æ´»å‹•è¨˜éŒ²</h2>
    <table>
        <thead>
            <tr>
                <th>æ¡ˆä»¶å</th>
                <th>æ´»å‹•ç¨®åˆ¥</th>
                <th>è¨˜éŒ²æ—¥æ™‚</th>
                <th>è¨˜éŒ²è€…</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in recent_activities %}
            <tr>
                <td><a href="{% url 'projects:project_detail' activity.project.pk %}">{{ activity.project.title }}</a></td>
                <td>{{ activity.get_activity_type_display }}</td>
                <td>{{ activity.log_date|date:"Y/m/d H:i" }}</td>
                <td>{{ activity.created_by }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">æ´»å‹•è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
